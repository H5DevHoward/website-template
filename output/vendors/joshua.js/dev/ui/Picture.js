define(["jquery","joshua/util/Class","joshua/util/Platform","modernizr"],function(e,t){var n=t.extend({init:function(t){this.$element=e(t)}});return n.className="js-picture",n.preload=function(t){n.options=t,n.items=e("."+n.className),n.totalCount=n.items.length,n.loadCount=0,n.totalCount==0&&n._doIfComplete(),n.items.each(function(e,t){(new n(t))._load()})},n._doIfComplete=function(){++n.loadCount,(n.totalCount==0||n.loadCount==n.totalCount&&n.options.onComplete)&&n.options.onComplete()},n.prototype._load=function(){var t=this;t._source=t.$element.attr("js-source"),t._imgtype=t.$element.attr("js-imgtype"),t._texture=e("<img>").one("load",function(){t._texture=this,t._render()}).on("error",function(){n._doIfComplete(),n.options.onError&&n.options.onError()}).attr("src",t._source)[0]},n.prototype._render=function(){var t=this;t._imgtype=="bg"?t.$element.css({"background-image":"url("+t._source+")"}):Modernizr.canvas&&!window.platform.isAndroid?(t._renderer=e('<canvas width="'+t._texture.width+'" height="'+t._texture.height+'">').appendTo(t.$element),t._context=t._renderer[0].getContext("2d"),t._context.drawImage(t._texture,0,0,t._texture.width,t._texture.height)):t._renderer=e('<img src="'+t._source+'" alt="">').appendTo(t.$element),n._doIfComplete(),n.options.onLoad&&n.options.onLoad()},n});