define(["jquery"],function(){var e={spring:.4,duration:900,maxDetail:40},t=function(e){this.$e=$(document),this.$e[0]._inst=this,this._init()},n=$(window);return t.prototype={constructor:t,options:undefined,targetTop:0,currentTop:0,scrollHeight:0,tmpScroll:null,intervalId:0,isLock:!1,inAnimate:!1,stageH:0,stageW:0,timeId:0,_init:function(){var e=this;this.scrollHeight=document.documentElement.scrollHeight-n.height(),e.targetTop=e.currentTop=this.$e.scrollTop(),this.tmpScroll=$("<div/>"),$(document).on("scroll",function(t){e.inAnimate||e._forceUpdate()})},_changePageResize:function(){var e=this;if(e.scrollHeight!=document.documentElement.scrollHeight-e.stageH||e.stageW!=n.width()||e.stageH!=n.height())e.stageW=n.width(),e.stageH=n.height(),e.scrollHeight=document.documentElement.scrollHeight-e.stageH,e._forceUpdate();clearTimeout(e.timeId),e.timeId=setTimeout(function(){e._changePageResize()},100)},_mousewheelEvent:function(e){e.preventDefault();if(this._inst.isLock)return;var t=e.originalEvent,n=t.detail?t.detail*30:-t.wheelDelta/3;Math.abs(n)>this._inst.options.maxDetail&&(n=n>0?this._inst.options.maxDetail:-this._inst.options.maxDetail),this._inst.targetTop+=n,this._inst.targetTop<0?this._inst.targetTop=0:this._inst.targetTop>this._inst.scrollHeight&&(this._inst.targetTop=this._inst.scrollHeight)},_animationLoop:function(){function s(){Math.abs(i.currentTop-i.targetTop)>0?(t=new Date,n=t-e,e=t,r=i.options.spring*n/17,r=r>.4?.4:r,i.currentTop+=(i.targetTop-i.currentTop)*r,i.currentTop=Math.round(i.currentTop*100)/100,i.currentTop<0&&(i.currentTop=0),Math.abs(i.currentTop-i.targetTop)<=1&&(i.currentTop=i.targetTop),i.currentTop>=0&&(i.$e.scrollTop(i.currentTop),i._triggerEvent()),i.inAnimate=!0):(i.currentTop=i.targetTop,i.inAnimate=!1),window.cancelAnimationFrame(i.intervalId),i.intervalId=window.requestAnimationFrame(s)}var e=new Date,t,n,r,i=this;s()},_forceUpdate:function(){if(!this.$e)return;this.scrollHeight=document.documentElement.scrollHeight-n.height(),this.currentTop=this.targetTop=this.$e.scrollTop(),this._triggerEvent()},_triggerEvent:function(){n.trigger($.Event(this.SMOOTH_SCROLL,{scrollTop:this.currentTop}))},enable:function(t){if(!this.$e)return;this.isEnable=!0,this._forceUpdate();if(!this.options||t)this.options=$.extend({},e,typeof t=="object"&&t);this.$e.on("mousewheel DOMMouseScroll",this._mousewheelEvent),this._animationLoop(),this._triggerEvent(),clearTimeout(this.timeId),this._changePageResize()},disable:function(){if(!this.$e)return;this.isEnable=!1,this.$e.off("mousewheel DOMMouseScroll",this._mousewheelEvent),window.cancelAnimationFrame(this.intervalId)},lock:function(){this.isLock=!0},unlock:function(){this._forceUpdate(),this.isLock=!1},destroy:function(){clearTimeout(this.timeId),this.disable(),delete this.$e._inst,delete this.$e;for(var e in this)delete this[e]},scrollTo:function(e,t,n){if(!this.$e)return;if(!this.options)return;if(!this.isEnable)return;var r=this,i=this.isLock;this.lock(),this.tmpScroll.css("top",this.currentTop),this.tmpScroll.animate({top:e},{duration:t?t:r.options.duration,step:function(e,t){r.targetTop=parseInt(e)},easing:n?n:"linear",complete:function(){i||r.unlock()}})},SMOOTH_SCROLL:"SmoothScroll"},window.requestAnimationFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)}}(),new t});